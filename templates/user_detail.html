{% extends 'base.html' %}
{% block content %}

  <h3>Welcome, {{user.name}}!</h3> 

 <h2>Your Hike List</h2>


 <div class='hike-div'>
    {% if user.usertrails|length == 0 %}
    <h4>No Hikes yet.</h4>
    <h4><a href="/search">Plan your Hikes</a>
    {% else %}
      
        <div class="container-fluid">
            <table class="table table-hover">
                <tr>
                    <th>Trail Name</th>
                    <th>Trail URL</th> 
                    <th>Trail Length (miles) </th>
                    <th>Date</th>
                    <th>Comments</th>
                    <th>Your Rating</th>
                    <th>Overall Rating</th>
                </tr>
                
                {% for usertrail in user.usertrails %}
                <tr>
                     {% for hike in usertrail.hikes %}
                        <input id="hike-comment" data-hike-id="{{ hike.hike_id }}" hidden>
                     {% endfor %}


                    <td>{{usertrail.trail.name}}</td>
                    <td><a href= "">{{usertrail.trail.url}}</a></td>
                    <td>{{usertrail.trail.length}}</td>
                    <td>{% for hike in usertrail.hikes %}
                            {{hike.date}}
                        {% endfor %}</td>
                    <td id="td-{{ usertrail.trail.trail_id }}">

                        {% for hike in usertrail.hikes %}
                            {% if not hike.comments %}
                            <span class="comment-span">
                            <input type="text" name="comments" placeholder"add your comments here" id="comments-{{ usertrail.trail.trail_id }}">
                            <button class="comment-it" data-trail-id="{{ usertrail.trail.trail_id }}" data-hike-id="{{ hike.hike_id }}" >Add</button>
                            </span><br>

                        {% else %}
                            {% for hike in usertrail.hikes %}
                                <span class="edit-comment"> {{hike.comments}} 
                                <!-- <input id="get-edit-comment" value="{{hike.comments}}" hidden>-->
                                <button class="edit-it" data-trail-id="{{ usertrail.trail.trail_id }}">Edit</button>
                                </span>
                            {% endfor %}    
                        {% endif %}</td>
                        {% endfor %}

                    <td>{% for hike in usertrail.hikes %}
                        <span class="rating-span">
                        <input type="number" name="your-rating" step="0.5" min="1" max="5">
                        <button class="rate-it" data-trail-id="{{ usertrail.trail.trail_id }}" data-hike-id="{{ hike.hike_id }}" > Rate </button>
                        {% endfor%} </td>

                    <td>{{ usertrail.rating }}</td>

                </tr>
                {% endfor %}
                
            </table>
    </div>
      
    {% endif %}
 </div>


<script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
<script>
  "use strict";

  /* Add Comments  */
  function showInfo(results){

    console.log("hi")
  }

  function getInfo(evt){
    evt.preventDefault();

    let inputId = $(this).data("trailId");
    let comments = $("#comments-"+inputId).val();
    let hikeId = $(this).data("hike-id");

    console.log(comments);

    var formInputs = {
        "trail_id": inputId,
        "comments": comments,
        "hike_id": hikeId
    }
    
    $.post("/add-trails-comment",formInputs, showInfo);

    $(this).attr("class", "edit-it")
    $(this).html("Edit")
    $(this).prev().remove()    
    $(this).before("<span>" +comments+ "</span>")

  }


  /*$(".comment-it").on('click', getInfo);*/
 $(document).on('click', ".comment-it", getInfo)

   /* Now Edit Comments  */
  function showComment(results){
    console.log("hi")
    
  }

  function getComment(evt){
    evt.preventDefault();
    
    debugger;
    old_comments = $(this).prev().text()
    $(this).prev().remove()
    $(this).before("<input type='text'>" + old_comments + "</input>")
    $(this).attr("class", "comment-it")
    $(this).html("Add")
    let comments = $("#comments-"+inputId).val();

    
    var formInputs = {
        "trail_id": $(this).data('trail-id'),
        "comments": comments
    }


    $.post("/add-trails-comment",formInputs, showComment);


  }

  $(document).on('click', ".edit-it", getComment)


</script>

{% endblock %}

